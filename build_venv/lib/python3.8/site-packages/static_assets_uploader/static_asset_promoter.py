"""
The promote static assets
"""
from typing import Any, Dict
import click
import yaml

from genesys_logging.logger import Logger

from .infra_api_client import InfraApiClient
from .static_asset_config import StaticAssetConfig

logger = Logger(clear_formatters=True)


class StaticAssetPromoter:
    """
    This will promote static assets
    """
    def __init__(self, root_path, service_version, service_env, api_env, secret_group_env):
        self.root_path = root_path
        self.service_version = service_version
        self.service_env = service_env
        self.api_env = api_env
        self.secret_group_env = secret_group_env
        self.static_assets = StaticAssetConfig(self.root_path)
        self.service_name = self.static_assets.service_name
        self.infra_api_client = InfraApiClient(api_env=self.api_env, secret_group_env=self.secret_group_env)

    def promote_assets(self) -> Dict[str, Any]:
        """ Makes an api call to the promote service to promote assets"""
        promote_path = f'/v1/promote/assets/serviceName/{self.service_name}/serviceVersion/{self.service_version}' \
                       f'/env/{self.service_env}/promote'
        promote_json = {
            'skynetToken': '',
        }
        # pylint: disable=C0301
        click.echo(f'{click.style(f" Calling infra-api ({self.api_env}) to promote the assets for {self.service_name}, {self.service_version} in {self.service_env}", fg="green")}', color=True)
        click.echo(f'{click.style(f" POST {promote_path}", fg="cyan")}', color=True)
        click.echo(f'{click.style(f" {yaml.dump(promote_json)}", fg="cyan")}', color=True)
        response = self.infra_api_client.post(path=promote_path, json=promote_json)
        return response.json()['content']
